name: 🚀 Deploy GitHub Pages from Release ZIP

# 在 release 发布时触发
on:
  release:
    types: [published]

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    permissions:
      contents: read          # 读取仓库内容
      pages: write            # 推送到 Pages
      id-token: write         # 用于 OIDC 身份验证

    steps:
      # 下载 Release ZIP 资产
      - name: Download release ZIP
        uses: dawidd6/action-download-release-asset@v2
        with:
          repository: ${{ github.repository }}
          tag: ${{ github.event.release.tag_name }}
          asset_name: WebGL_Demo.zip          # 你在 Release 上传的 ZIP 名称
          download_path: ./releases

      # 解压 ZIP 到 output 目录
      - name: Extract site content
        run: |
          mkdir output
          unzip -q ./releases/site.zip -d output

      # 必须先配置 Pages 环境（设置部署分支、文件夹等）
      - name: Configure Pages
        uses: actions/configure-pages@v3

      # 上传解压后的静态文件，作为后续部署的数据源
      - name: Upload Pages artifact
        uses: actions/upload-pages-artifact@v1
        with:
          path: output

      # 部署到 GitHub Pages
      - name: Deploy to GitHub Pages
        uses: actions/deploy-pages@v1
